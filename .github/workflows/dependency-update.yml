name: Dependency Updates

on:
  schedule:
    - cron: '0 9 * * 1'  # Weekly Monday 9AM
  workflow_dispatch:

jobs:
  update-dependencies:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: '3.11'
          
      - name: Install pip-tools
        run: pip install pip-tools
        
      - name: Update Python dependencies
        run: |
          pip-compile --upgrade requirements.txt
          
      - name: Check for updates
        id: check-updates
        run: |
          if git diff --quiet requirements.txt; then
            echo "No updates available"
            echo "has_updates=false" >> $GITHUB_OUTPUT
          else
            echo "Updates available"
            echo "has_updates=true" >> $GITHUB_OUTPUT
          fi
          
      - name: Create Pull Request
        if: steps.check-updates.outputs.has_updates == 'true'
        uses: peter-evans/create-pull-request@v7
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: update Python dependencies"
          title: "ðŸ”„ Weekly Dependency Updates"
          body: |
            ## ðŸ“¦ Automated Dependency Updates
            
            This PR updates Python dependencies to their latest versions.
            
            **Changes:**
            - Updated requirements.txt with latest package versions
            
            **Next Steps:**
            - Review the changes
            - Test locally if needed
            - Merge when ready
            
            ðŸ¤– Generated by GitHub Actions
          branch: dependency-updates
          delete-branch: true