
<!DOCTYPE html>
<html>
<head>
    <title>Fix It Fred AI - ChatterFix Integration</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f8f9fa; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; color: #006fee; margin-bottom: 30px; }
        .code-block { background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px; padding: 20px; margin: 20px 0; overflow-x: auto; }
        .btn { background: linear-gradient(135deg, #006fee, #4285f4); color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0, 111, 238, 0.3); }
        .feature-list { background: rgba(0, 111, 238, 0.05); padding: 20px; border-radius: 8px; margin: 20px 0; }
        .feature-list li { margin: 8px 0; }
        .instructions { background: #fff3cd; border: 1px solid #ffeaa7; padding: 20px; border-radius: 8px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Fix It Fred AI Integration</h1>
            <h2>Advanced AI Assistant for ChatterFix CMMS</h2>
        </div>
        
        <div class="feature-list">
            <h3>üîß AI Capabilities:</h3>
            <ul>
                <li>Intelligent equipment troubleshooting</li><li>Predictive maintenance planning</li><li>Safety protocol guidance</li><li>Parts identification and management</li><li>Real-time technical support</li><li>ChatterFix CMMS optimization</li>
            </ul>
        </div>
        
        <div class="instructions">
            <h3>üìã Integration Instructions:</h3>
            <ol>
                <li>Open ChatterFix in your browser: <a href="http://localhost:8000" target="_blank">http://localhost:8000</a></li>
                <li>Open browser developer tools (F12)</li>
                <li>Go to the Console tab</li>
                <li>Copy and paste the script below</li>
                <li>Press Enter to activate Fix It Fred AI</li>
            </ol>
        </div>
        
        <h3>üöÄ Integration Script:</h3>
        <div class="code-block">
            <button class="btn" onclick="copyToClipboard()">üìã Copy Script</button>
            <pre id="integration-script">// ü§ñ Fix It Fred AI Chat Integration for ChatterFix CMMS
// The most powerful AI assistant integration for maintenance management
// Connects ChatterFix directly to Fix It Fred AI services

class FixItFredAI {
    constructor() {
        this.apiBase = 'http://localhost:8005'; // Fix It Fred AI Service
        this.fallbackAPI = 'http://localhost:8008'; // AI Development Team
        this.name = 'Fix It Fred';
        this.version = '3.0 Pro';
        this.capabilities = [
            'Equipment Troubleshooting',
            'Maintenance Planning', 
            'Parts Identification',
            'Safety Protocols',
            'Predictive Analytics',
            'Work Order Optimization'
        ];
        this.initializeUI();
    }

    async sendMessage(message, context = 'maintenance') {
        console.log(`üîß Fix It Fred processing: ${message}`);
        
        try {
            // Try direct AI chat first
            const response = await this.tryDirectAIChat(message, context);
            if (response) return response;
            
            // Try AI team collaboration
            const teamResponse = await this.tryAITeamChat(message, context);
            if (teamResponse) return teamResponse;
            
            // Intelligent fallback with maintenance expertise
            return this.getIntelligentFallback(message);
            
        } catch (error) {
            console.error('Fix It Fred error:', error);
            return this.getIntelligentFallback(message);
        }
    }

    async tryDirectAIChat(message, context) {
        try {
            const payload = {
                message: `As Fix It Fred, the world's most advanced maintenance AI assistant, please help with: "${message}". 
                
Context: ${context}
Focus on: ChatterFix CMMS platform capabilities, maintenance best practices, equipment troubleshooting, and safety protocols.

Please provide:
1. Direct, actionable advice
2. Safety considerations
3. ChatterFix feature recommendations
4. Next steps

Be professional, knowledgeable, and focus on practical solutions.`,
                context: context,
                system_prompt: "You are Fix It Fred, an expert maintenance technician AI with decades of experience in industrial maintenance, CMMS systems, and equipment troubleshooting."
            };

            const response = await fetch(`${this.apiBase}/api/chat`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (response.ok) {
                const data = await response.json();
                if (data.response) {
                    return this.formatAIResponse(data.response, 'direct');
                }
            }
        } catch (error) {
            console.log('Direct AI chat failed, trying alternative endpoints...');
        }
        return null;
    }

    async tryAITeamChat(message, context) {
        try {
            // Create AI team collaboration for complex maintenance questions
            const collaborationResponse = await fetch(`${this.fallbackAPI}/api/collaboration`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(['maintenance_expert', 'safety_officer', 'efficiency_optimizer'])
            }, { params: { objective: `Provide comprehensive maintenance guidance for: ${message}` }});

            if (collaborationResponse.ok) {
                const collaboration = await collaborationResponse.json();
                return this.formatAIResponse(
                    `‚úÖ AI Team assembled for your maintenance question!\n\nOur expert team is analyzing: "${message}"\n\nThis advanced AI collaboration will provide you with comprehensive guidance covering equipment analysis, safety protocols, and optimization strategies.`,
                    'team'
                );
            }
        } catch (error) {
            console.log('AI team collaboration failed, using intelligent fallback...');
        }
        return null;
    }

    formatAIResponse(response, type = 'direct') {
        const expertise = type === 'team' ? 'üß† AI Team Response' : 'üîß Fix It Fred';
        
        let formattedResponse = `
            &lt;div class="fred-response"&gt;
                &lt;div class="fred-header"&gt;
                    &lt;span class="fred-icon"&gt;${expertise}&lt;/span&gt;
                    &lt;span class="fred-badge"&gt;Professional Maintenance AI&lt;/span&gt;
                &lt;/div&gt;
                &lt;div class="fred-content"&gt;${response}&lt;/div&gt;
                &lt;div class="fred-features"&gt;
                    &lt;strong&gt;üõ†Ô∏è ChatterFix CMMS Integration:&lt;/strong&gt;
                    &lt;div class="feature-grid"&gt;
                        &lt;button onclick="window.fredAI.quickAction('workorder')" class="quick-btn"&gt;üìù Create Work Order&lt;/button&gt;
                        &lt;button onclick="window.fredAI.quickAction('assets')" class="quick-btn"&gt;üè≠ Asset Management&lt;/button&gt;
                        &lt;button onclick="window.fredAI.quickAction('parts')" class="quick-btn"&gt;üîß Parts Lookup&lt;/button&gt;
                        &lt;button onclick="window.fredAI.quickAction('analytics')" class="quick-btn"&gt;üìä Analytics&lt;/button&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class="fred-footer"&gt;
                    &lt;span&gt;Powered by Fix It Fred AI v${this.version} | ChatterFix CMMS Pro&lt;/span&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        `;
        
        return formattedResponse;
    }

    getIntelligentFallback(message) {
        // Analyze message for maintenance context
        const maintenanceKeywords = {
            equipment: ['motor', 'pump', 'valve', 'bearing', 'belt', 'machine', 'equipment'],
            electrical: ['electrical', 'wire', 'circuit', 'voltage', 'amp', 'power', 'electric'],
            hydraulic: ['hydraulic', 'fluid', 'pressure', 'hose', 'cylinder', 'pump'],
            safety: ['safety', 'lockout', 'tagout', 'ppe', 'hazard', 'risk'],
            planning: ['schedule', 'plan', 'maintenance', 'preventive', 'predictive'],
            parts: ['part', 'spare', 'inventory', 'order', 'stock', 'replacement']
        };

        let category = 'general';
        let categoryMatch = '';
        
        for (const [cat, keywords] of Object.entries(maintenanceKeywords)) {
            if (keywords.some(keyword =&gt; message.toLowerCase().includes(keyword))) {
                category = cat;
                categoryMatch = keywords.find(k =&gt; message.toLowerCase().includes(k));
                break;
            }
        }

        const responses = {
            equipment: `üîß **Equipment Analysis Mode**\n\nI see you're asking about "${categoryMatch}" related maintenance. Here's what Fix It Fred recommends:\n\n**Immediate Actions:**\n‚úÖ Safety first - ensure equipment is locked out\n‚úÖ Visual inspection for obvious issues\n‚úÖ Check maintenance history in ChatterFix\n\n**ChatterFix Features to Use:**\nüìù Create diagnostic work order\nüìä Review equipment analytics\nüîç Check parts availability`,
            
            electrical: `‚ö° **Electrical Systems Expert**\n\nFor electrical maintenance involving "${categoryMatch}":\n\n**Safety Protocol:**\nüö® LOCKOUT/TAGOUT procedures mandatory\nüö® Verify zero energy state\nüö® Use appropriate PPE\n\n**Diagnostic Steps:**\n1. Visual inspection for damage\n2. Voltage/continuity testing\n3. Load analysis\n\n**ChatterFix Integration:**\nüìã Log all electrical work\nüîÑ Schedule follow-up inspections`,

            hydraulic: `üè≠ **Hydraulic Systems Specialist**\n\nHydraulic system maintenance for "${categoryMatch}":\n\n**Key Checks:**\n‚Ä¢ Fluid levels and condition\n‚Ä¢ Pressure readings\n‚Ä¢ Leak inspection\n‚Ä¢ Filter condition\n\n**Maintenance Actions:**\n‚úÖ Use ChatterFix to track fluid changes\n‚úÖ Monitor pressure trends\n‚úÖ Schedule proactive replacements`,

            safety: `üõ°Ô∏è **Safety Protocol Advisor**\n\nSafety is our top priority for "${categoryMatch}":\n\n**Essential Steps:**\nüîí Lockout/Tagout procedures\nüë∑ Proper PPE requirements\n‚ö†Ô∏è Hazard identification\nüìã Safety documentation\n\n**ChatterFix Safety Features:**\nüìä Safety incident tracking\nüîÑ Compliance monitoring\nüìù Safety checklist integration`,

            planning: `üìÖ **Maintenance Planning Expert**\n\nOptimizing "${categoryMatch}" strategies:\n\n**Planning Framework:**\nüéØ Preventive maintenance scheduling\nüìà Predictive analytics integration\nüí∞ Cost optimization\n‚è±Ô∏è Downtime minimization\n\n**ChatterFix Planning Tools:**\nüìä Advanced analytics dashboard\nüîÑ Automated scheduling\nüìà Performance trending`,

            parts: `üîß **Parts & Inventory Specialist**\n\nManaging "${categoryMatch}" efficiently:\n\n**Inventory Optimization:**\nüì¶ Smart stock levels\nüîÑ Automated reordering\nüí∞ Cost tracking\n‚ö° Emergency availability\n\n**ChatterFix Inventory Features:**\nüìä Real-time stock monitoring\nüîç Parts cross-referencing\nüìà Usage analytics\nüö® Low stock alerts`,

            general: `üëã **Fix It Fred AI Assistant**\n\nI'm here to help with all your maintenance needs!\n\n**Core Capabilities:**\nüîß Equipment troubleshooting\nüìÖ Maintenance planning\nüõ°Ô∏è Safety protocols\nüìä Performance optimization\n\n**ChatterFix CMMS Integration:**\n‚ú® AI-powered work orders\nüè≠ Predictive maintenance\nüì± Mobile technician tools\nü§ñ Intelligent automation`
        };

        return this.formatAIResponse(responses[category], 'intelligent');
    }

    quickAction(action) {
        const actions = {
            workorder: () =&gt; {
                window.open('/dashboard/work-orders/create', '_blank');
                this.showToast('üîß Opening Work Order Creator...');
            },
            assets: () =&gt; {
                window.open('/dashboard/assets', '_blank');
                this.showToast('üè≠ Accessing Asset Management...');
            },
            parts: () =&gt; {
                window.open('/dashboard/parts', '_blank');
                this.showToast('üîß Opening Parts Inventory...');
            },
            analytics: () =&gt; {
                window.open('/dashboard/analytics', '_blank');
                this.showToast('üìä Loading Analytics Dashboard...');
            }
        };
        
        if (actions[action]) {
            actions[action]();
        }
    }

    showToast(message) {
        const toast = document.createElement('div');
        toast.className = 'fred-toast';
        toast.innerHTML = message;
        toast.style.cssText = `
            position: fixed; top: 20px; right: 20px; z-index: 10000;
            background: linear-gradient(135deg, #006fee, #4285f4);
            color: white; padding: 15px 20px; border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-weight: 500; animation: slideIn 0.3s ease;
        `;
        
        document.body.appendChild(toast);
        setTimeout(() =&gt; {
            toast.style.animation = 'slideOut 0.3s ease';
            setTimeout(() =&gt; toast.remove(), 300);
        }, 3000);
    }

    initializeUI() {
        // Add Fix It Fred specific styles
        if (!document.getElementById('fred-ai-styles')) {
            const styles = document.createElement('style');
            styles.id = 'fred-ai-styles';
            styles.textContent = `
                .fred-response {
                    background: linear-gradient(135deg, #f8f9ff, #e8f2ff);
                    border: 2px solid #006fee;
                    border-radius: 12px;
                    padding: 20px;
                    margin: 10px 0;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                }
                
                .fred-header {
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    margin-bottom: 15px;
                    padding-bottom: 10px;
                    border-bottom: 1px solid #e0e8ff;
                }
                
                .fred-icon {
                    font-size: 16px;
                    font-weight: bold;
                    color: #006fee;
                }
                
                .fred-badge {
                    background: linear-gradient(135deg, #006fee, #4285f4);
                    color: white;
                    padding: 4px 12px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-weight: 600;
                }
                
                .fred-content {
                    line-height: 1.6;
                    color: #333;
                    margin-bottom: 20px;
                }
                
                .fred-features {
                    background: rgba(0, 111, 238, 0.05);
                    padding: 15px;
                    border-radius: 8px;
                    margin: 15px 0;
                }
                
                .feature-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                    gap: 8px;
                    margin-top: 10px;
                }
                
                .quick-btn {
                    background: linear-gradient(135deg, #006fee, #4285f4);
                    color: white;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 6px;
                    font-size: 12px;
                    font-weight: 500;
                    cursor: pointer;
                    transition: all 0.2s ease;
                }
                
                .quick-btn:hover {
                    transform: translateY(-1px);
                    box-shadow: 0 4px 8px rgba(0, 111, 238, 0.3);
                }
                
                .fred-footer {
                    text-align: center;
                    font-size: 11px;
                    color: #666;
                    margin-top: 15px;
                    padding-top: 10px;
                    border-top: 1px solid #e0e8ff;
                }
                
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
                
                .thinking-animation {
                    display: inline-block;
                    animation: pulse 1.5s infinite;
                }
                
                @keyframes pulse {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.5; }
                }
            `;
            document.head.appendChild(styles);
        }
    }
}

// Enhanced Chat Integration
class ChatterFixFredIntegration {
    constructor() {
        this.fredAI = new FixItFredAI();
        this.initializeChatOverride();
        console.log('üöÄ Fix It Fred AI integrated with ChatterFix CMMS!');
    }

    initializeChatOverride() {
        // Override the sendChatMessage function if it exists
        window.sendChatMessage = async (message) =&gt; {
            await this.handleChatMessage(message);
        };

        // Also override sendMessage for compatibility
        window.sendMessage = () =&gt; {
            const input = document.getElementById('chat-input');
            if (input && input.value.trim()) {
                const message = input.value.trim();
                input.value = '';
                this.handleChatMessage(message);
            }
        };

        // Make fredAI globally available for quick actions
        window.fredAI = this.fredAI;
    }

    async handleChatMessage(message) {
        const chatMessages = document.getElementById('chat-messages');
        if (!chatMessages) {
            console.warn('Chat messages container not found');
            return;
        }

        // Add user message
        this.addMessage(chatMessages, message, 'user');

        // Add thinking indicator
        const thinkingId = this.addThinkingMessage(chatMessages);

        try {
            // Get AI response
            const response = await this.fredAI.sendMessage(message);
            
            // Remove thinking indicator
            const thinkingElement = document.getElementById(thinkingId);
            if (thinkingElement) thinkingElement.remove();
            
            // Add AI response
            this.addMessage(chatMessages, response, 'assistant');
            
        } catch (error) {
            console.error('Chat error:', error);
            
            // Remove thinking indicator
            const thinkingElement = document.getElementById(thinkingId);
            if (thinkingElement) thinkingElement.remove();
            
            // Add error message
            this.addMessage(chatMessages, 
                this.fredAI.getIntelligentFallback(message), 
                'assistant'
            );
        }

        // Scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    addMessage(container, content, type) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}-message`;
        
        if (type === 'user') {
            messageDiv.innerHTML = `&lt;div class="message-content"&gt;${content}&lt;/div&gt;`;
        } else {
            messageDiv.innerHTML = `&lt;div class="message-content"&gt;${content}&lt;/div&gt;`;
        }
        
        container.appendChild(messageDiv);
        return messageDiv;
    }

    addThinkingMessage(container) {
        const thinkingId = 'thinking-' + Date.now();
        const thinkingDiv = document.createElement('div');
        thinkingDiv.id = thinkingId;
        thinkingDiv.className = 'message assistant-message';
        thinkingDiv.innerHTML = `
            &lt;div class="message-content"&gt;
                &lt;div style="display: flex; align-items: center; gap: 10px;"&gt;
                    ü§ñ &lt;span class="thinking-animation"&gt;Fix It Fred is analyzing your maintenance question...&lt;/span&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        `;
        container.appendChild(thinkingDiv);
        return thinkingId;
    }
}

// Auto-initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () =&gt; {
        window.chatterFixFred = new ChatterFixFredIntegration();
    });
} else {
    window.chatterFixFred = new ChatterFixFredIntegration();
}

console.log('üîß Fix It Fred AI Integration Loaded!');
console.log('üéØ ChatterFix CMMS now powered by advanced AI assistant!');</pre>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="btn" onclick="window.open('http://localhost:8000', '_blank')">üöÄ Open ChatterFix</button>
            <button class="btn" onclick="testAI()" style="margin-left: 10px;">üß™ Test AI Connection</button>
        </div>
        
        <div id="test-results" style="margin-top: 20px;"></div>
    </div>
    
    <script>
        function copyToClipboard() {
            const script = document.getElementById('integration-script').textContent;
            navigator.clipboard.writeText(script).then(function() {
                alert('‚úÖ Fix It Fred AI script copied to clipboard!\n\nNow:\n1. Open ChatterFix\n2. Open developer tools (F12)\n3. Paste in console\n4. Press Enter');
            });
        }
        
        async function testAI() {
            const resultDiv = document.getElementById('test-results');
            resultDiv.innerHTML = '<p>üß™ Testing AI connections...</p>';
            
            try {
                // Test Fix It Fred AI
                const fredResponse = await fetch('http://localhost:8001/health');
                const fredData = await fredResponse.json();
                
                // Test ChatterFix
                const chatterResponse = await fetch('http://localhost:8000/health');
                const chatterData = await chatterResponse.json();
                
                resultDiv.innerHTML = `
                    <div style="background: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 8px;">
                        <h4>‚úÖ Connection Test Results:</h4>
                        <p><strong>Fix It Fred AI:</strong> ${fredData.status} - ${fredData.service || 'Ready'}</p>
                        <p><strong>ChatterFix CMMS:</strong> ${chatterData.status} - ${chatterData.gateway || 'Platform Gateway'}</p>
                        <p><strong>Status:</strong> Ready for integration! üöÄ</p>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 8px;">
                        <h4>‚ö†Ô∏è Connection Issue:</h4>
                        <p>Error: ${error.message}</p>
                        <p>Please ensure both ChatterFix and Fix It Fred AI services are running.</p>
                    </div>
                `;
            }
        }
        
        // Auto-test on page load
        window.onload = function() {
            setTimeout(testAI, 1000);
        };
    </script>
</body>
</html>
