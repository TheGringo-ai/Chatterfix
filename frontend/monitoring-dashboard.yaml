displayName: "ChatterFix Consolidated CMMS Dashboard"
mosaicLayout:
  tiles:
  - width: 6
    height: 4
    widget:
      title: "Consolidated CMMS Service Health"
      scorecard:
        timeSeriesQuery:
          timeSeriesFilter:
            filter: 'resource.type="cloud_run_revision" AND resource.labels.service_name="chatterfix-consolidated-cmms"'
            aggregation:
              alignmentPeriod: "60s"
              perSeriesAligner: ALIGN_RATE
              crossSeriesReducer: REDUCE_SUM
        sparkChartView:
          sparkChartType: SPARK_LINE
  
  - width: 6
    height: 4
    xPos: 6
    widget:
      title: "Request Latency by Endpoint"
      xyChart:
        dataSets:
        - timeSeriesQuery:
            timeSeriesFilter:
              filter: 'resource.type="cloud_run_revision" AND resource.labels.service_name="chatterfix-consolidated-cmms"'
              aggregation:
                alignmentPeriod: "60s"
                perSeriesAligner: ALIGN_DELTA
                crossSeriesReducer: REDUCE_MEAN
                groupByFields: ["metric.labels.method", "metric.labels.route"]
        yAxis:
          label: "Latency (ms)"
        chartOptions:
          mode: COLOR
  
  - width: 12
    height: 4
    yPos: 4
    widget:
      title: "CMMS Module Usage"
      xyChart:
        dataSets:
        - timeSeriesQuery:
            timeSeriesFilter:
              filter: 'resource.type="cloud_run_revision" AND resource.labels.service_name="chatterfix-consolidated-cmms" AND (metric.labels.route=~"/work_orders.*" OR metric.labels.route=~"/assets.*" OR metric.labels.route=~"/parts.*")'
              aggregation:
                alignmentPeriod: "300s"
                perSeriesAligner: ALIGN_RATE
                crossSeriesReducer: REDUCE_SUM
                groupByFields: ["metric.labels.route"]
        yAxis:
          label: "Requests per second"
        chartOptions:
          mode: STACKED_AREA
  
  - width: 6
    height: 4
    yPos: 8
    widget:
      title: "Memory Usage"
      xyChart:
        dataSets:
        - timeSeriesQuery:
            timeSeriesFilter:
              filter: 'resource.type="cloud_run_revision" AND resource.labels.service_name="chatterfix-consolidated-cmms" AND metric.type="run.googleapis.com/container/memory/utilizations"'
              aggregation:
                alignmentPeriod: "60s"
                perSeriesAligner: ALIGN_MEAN
        yAxis:
          label: "Memory Utilization (%)"
  
  - width: 6
    height: 4
    xPos: 6
    yPos: 8
    widget:
      title: "CPU Usage"
      xyChart:
        dataSets:
        - timeSeriesQuery:
            timeSeriesFilter:
              filter: 'resource.type="cloud_run_revision" AND resource.labels.service_name="chatterfix-consolidated-cmms" AND metric.type="run.googleapis.com/container/cpu/utilizations"'
              aggregation:
                alignmentPeriod: "60s"
                perSeriesAligner: ALIGN_MEAN
        yAxis:
          label: "CPU Utilization (%)"

  - width: 12
    height: 4
    yPos: 12
    widget:
      title: "Error Rate by Endpoint"
      xyChart:
        dataSets:
        - timeSeriesQuery:
            timeSeriesFilter:
              filter: 'resource.type="cloud_run_revision" AND resource.labels.service_name="chatterfix-consolidated-cmms" AND (metric.labels.response_code_class="4xx" OR metric.labels.response_code_class="5xx")'
              aggregation:
                alignmentPeriod: "300s"
                perSeriesAligner: ALIGN_RATE
                crossSeriesReducer: REDUCE_SUM
                groupByFields: ["metric.labels.route", "metric.labels.response_code_class"]
        yAxis:
          label: "Errors per second"
        chartOptions:
          mode: STACKED_BAR