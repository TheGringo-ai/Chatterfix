{% extends "base.html" %}

{% block title %}ChatterFix CMMS - Scheduler{% endblock %}
{% block page_icon %}üìÖ{% endblock %}
{% block page_title %}Scheduler Dashboard{% endblock %}
{% block page_subtitle %}Plan, schedule, and optimize maintenance activities{% endblock %}

{% block action_buttons %}
<button class="btn btn-success" onclick="createSchedule()">
    ‚ûï Create Schedule
</button>
<button class="btn btn-info" onclick="optimizeSchedule()">
    ‚ö° Optimize Schedule
</button>
<button class="btn btn-warning" onclick="bulkReschedule()">
    üîÑ Bulk Reschedule
</button>
<button class="btn btn-primary" onclick="exportSchedule()">
    üì• Export Calendar
</button>
{% endblock %}

{% block summary_stats %}
<div class="summary-grid">
    <div class="summary-card">
        <h3>This Week</h3>
        <div class="value">24</div>
        <div class="subtitle">Scheduled tasks</div>
        <div class="ai-insight">ü§ñ üìÖ Optimal distribution</div>
    </div>
    
    <div class="summary-card">
        <h3>Resource Utilization</h3>
        <div class="value">87%</div>
        <div class="subtitle">Team capacity</div>
        <div class="ai-insight">ü§ñ ‚ö° Well balanced</div>
    </div>
    
    <div class="summary-card">
        <h3>Schedule Conflicts</h3>
        <div class="value">2</div>
        <div class="subtitle">Need resolution</div>
        <div class="ai-insight">ü§ñ ‚ö†Ô∏è Easy to resolve</div>
    </div>
    
    <div class="summary-card">
        <h3>Compliance Rate</h3>
        <div class="value">98%</div>
        <div class="subtitle">On-time completion</div>
        <div class="ai-insight">ü§ñ üéØ Exceeds target</div>
    </div>
</div>
{% endblock %}

{% block content %}
<!-- Calendar View Controls -->
<div class="chatterfix-card">
    <h3 style="margin-bottom: 1rem;">üìÖ Schedule View Controls</h3>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; justify-content: space-between;">
        <div style="display: flex; gap: 1rem; align-items: center;">
            <select id="viewType" onchange="changeCalendarView()" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px;">
                <option value="week">Week View</option>
                <option value="month">Month View</option>
                <option value="day">Day View</option>
                <option value="agenda">Agenda View</option>
            </select>
            
            <select id="filterBy" onchange="applyScheduleFilter()" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px;">
                <option value="">All Activities</option>
                <option value="preventive">Preventive Maintenance</option>
                <option value="corrective">Corrective Maintenance</option>
                <option value="inspection">Inspections</option>
                <option value="emergency">Emergency Repairs</option>
            </select>
            
            <select id="technicianFilter" onchange="applyScheduleFilter()" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px;">
                <option value="">All Technicians</option>
                <option value="john">John Smith</option>
                <option value="sarah">Sarah Johnson</option>
                <option value="mike">Mike Wilson</option>
            </select>
        </div>
        
        <div style="display: flex; gap: 0.5rem;">
            <button class="btn btn-secondary" onclick="previousPeriod()">‚Üê Previous</button>
            <button class="btn btn-primary" onclick="today()">Today</button>
            <button class="btn btn-secondary" onclick="nextPeriod()">Next ‚Üí</button>
        </div>
    </div>
</div>

<div class="chatterfix-grid grid-cols-2">
    
    <!-- Weekly Calendar View -->
    <div class="chatterfix-card">
        <h3 style="margin-bottom: 1.5rem;">üìÖ Weekly Schedule</h3>
        
        <!-- Calendar Header -->
        <div style="display: grid; grid-template-columns: 60px repeat(7, 1fr); gap: 1px; margin-bottom: 1rem;">
            <div style="background: var(--bg-tertiary); padding: 0.5rem; text-align: center; font-weight: 600; border-radius: 4px;"></div>
            <div style="background: var(--bg-tertiary); padding: 0.5rem; text-align: center; font-weight: 600; border-radius: 4px;">Mon</div>
            <div style="background: var(--bg-tertiary); padding: 0.5rem; text-align: center; font-weight: 600; border-radius: 4px;">Tue</div>
            <div style="background: var(--bg-tertiary); padding: 0.5rem; text-align: center; font-weight: 600; border-radius: 4px;">Wed</div>
            <div style="background: var(--bg-tertiary); padding: 0.5rem; text-align: center; font-weight: 600; border-radius: 4px;">Thu</div>
            <div style="background: var(--bg-tertiary); padding: 0.5rem; text-align: center; font-weight: 600; border-radius: 4px;">Fri</div>
            <div style="background: var(--bg-tertiary); padding: 0.5rem; text-align: center; font-weight: 600; border-radius: 4px;">Sat</div>
            <div style="background: var(--bg-tertiary); padding: 0.5rem; text-align: center; font-weight: 600; border-radius: 4px;">Sun</div>
        </div>
        
        <!-- Time Slots -->
        <div style="max-height: 500px; overflow-y: auto;">
            <div style="display: grid; grid-template-columns: 60px repeat(7, 1fr); gap: 1px;">
                <!-- 8 AM -->
                <div style="background: var(--bg-secondary); padding: 0.5rem; text-align: center; font-size: 0.8rem;">8 AM</div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color); position: relative;">
                    <div style="background: var(--success-green); color: white; padding: 0.25rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;" onclick="viewScheduleItem('pm-001')">
                        PM: Pump #1
                    </div>
                </div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);">
                    <div style="background: var(--warning-amber); color: white; padding: 0.25rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;" onclick="viewScheduleItem('cm-002')">
                        Inspect: HVAC
                    </div>
                </div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);">
                    <div style="background: var(--primary-blue); color: white; padding: 0.25rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;" onclick="viewScheduleItem('pm-003')">
                        Service: Motor
                    </div>
                </div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
                
                <!-- 10 AM -->
                <div style="background: var(--bg-secondary); padding: 0.5rem; text-align: center; font-size: 0.8rem;">10 AM</div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);">
                    <div style="background: var(--info-purple); color: white; padding: 0.25rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;" onclick="viewScheduleItem('em-001')">
                        Emergency: Conveyor
                    </div>
                </div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);">
                    <div style="background: var(--success-green); color: white; padding: 0.25rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;" onclick="viewScheduleItem('pm-004')">
                        PM: Boiler
                    </div>
                </div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
                
                <!-- 2 PM -->
                <div style="background: var(--bg-secondary); padding: 0.5rem; text-align: center; font-size: 0.8rem;">2 PM</div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);">
                    <div style="background: var(--warning-amber); color: white; padding: 0.25rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;" onclick="viewScheduleItem('in-001')">
                        Inspect: Safety
                    </div>
                </div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);">
                    <div style="background: var(--primary-blue); color: white; padding: 0.25rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;" onclick="viewScheduleItem('pm-005')">
                        PM: Compressor
                    </div>
                </div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
                <div style="background: var(--bg-card); padding: 0.5rem; min-height: 60px; border: 1px dashed var(--border-color);"></div>
            </div>
        </div>
        
        <!-- Drag & Drop Instructions -->
        <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: var(--border-radius); font-size: 0.9rem; color: var(--text-secondary);">
            üí° Click on tasks to view details, drag to reschedule. Empty slots are available for new assignments.
        </div>
    </div>
    
    <!-- Schedule Management Tools -->
    <div class="chatterfix-card">
        <h3 style="margin-bottom: 1.5rem;">üõ†Ô∏è Schedule Management</h3>
        
        <!-- Scheduling Conflicts -->
        <div style="margin-bottom: 2rem;">
            <h4 style="margin-bottom: 1rem; color: var(--error-red);">‚ö†Ô∏è Schedule Conflicts</h4>
            <div style="background: rgba(244, 67, 54, 0.1); padding: 1rem; border-radius: var(--border-radius); border-left: 3px solid var(--error-red); margin-bottom: 0.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>John Smith - Double Booking</strong>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                            Wed 10 AM: Pump #1 & HVAC Unit overlap
                        </div>
                    </div>
                    <button onclick="resolveConflict('conflict-001')" class="btn btn-sm btn-warning">Resolve</button>
                </div>
            </div>
            
            <div style="background: rgba(255, 152, 0, 0.1); padding: 1rem; border-radius: var(--border-radius); border-left: 3px solid var(--warning-amber);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>Resource Shortage</strong>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                            Thu 2 PM: No certified electrical technician available
                        </div>
                    </div>
                    <button onclick="resolveConflict('conflict-002')" class="btn btn-sm btn-warning">Resolve</button>
                </div>
            </div>
        </div>
        
        <!-- Upcoming Maintenance -->
        <div style="margin-bottom: 2rem;">
            <h4 style="margin-bottom: 1rem;">üìã Upcoming Scheduled Maintenance</h4>
            <div style="max-height: 200px; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid var(--border-color);">
                    <div>
                        <strong>Pump #1 - Preventive Maintenance</strong>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Mon 8:00 AM ‚Ä¢ John Smith ‚Ä¢ 2 hours</div>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="rescheduleTask('pm-001')" class="btn btn-sm btn-warning">Reschedule</button>
                        <button onclick="assignTechnician('pm-001')" class="btn btn-sm btn-primary">Reassign</button>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid var(--border-color);">
                    <div>
                        <strong>HVAC Unit A - Filter Replacement</strong>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Wed 10:00 AM ‚Ä¢ Sarah Johnson ‚Ä¢ 1 hour</div>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="rescheduleTask('pm-002')" class="btn btn-sm btn-warning">Reschedule</button>
                        <button onclick="assignTechnician('pm-002')" class="btn btn-sm btn-primary">Reassign</button>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid var(--border-color);">
                    <div>
                        <strong>Motor #2 - Bearing Service</strong>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Fri 8:00 AM ‚Ä¢ Mike Wilson ‚Ä¢ 3 hours</div>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="rescheduleTask('pm-003')" class="btn btn-sm btn-warning">Reschedule</button>
                        <button onclick="assignTechnician('pm-003')" class="btn btn-sm btn-primary">Reassign</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Schedule Optimization -->
        <div style="background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue)); color: white; padding: 1.5rem; border-radius: var(--border-radius);">
            <h4 style="margin-bottom: 1rem;">ü§ñ AI Schedule Optimization</h4>
            <div style="margin-bottom: 1rem;">
                <div style="margin-bottom: 0.5rem;">‚Ä¢ Optimize for 23% efficiency improvement this week</div>
                <div style="margin-bottom: 0.5rem;">‚Ä¢ Balance workload - John is overallocated by 15%</div>
                <div style="margin-bottom: 0.5rem;">‚Ä¢ Reschedule 3 tasks to avoid equipment downtime overlap</div>
                <div style="margin-bottom: 0.5rem;">‚Ä¢ Suggest preventive maintenance during low-demand periods</div>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button onclick="applyAIOptimization()" class="btn btn-sm" style="background: white; color: var(--primary-blue);">
                    ‚ö° Apply AI Optimization
                </button>
                <button onclick="previewOptimization()" class="btn btn-sm" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white;">
                    üëÅÔ∏è Preview Changes
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Resource Planning -->
<div class="chatterfix-card">
    <h3 style="margin-bottom: 1.5rem;">üë• Resource Planning & Availability</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
        
        <!-- Technician Availability -->
        <div>
            <h4 style="margin-bottom: 1rem;">üë∑ Technician Availability</h4>
            <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--border-radius);">
                <div style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-weight: 600;">John Smith</span>
                        <span style="font-size: 0.9rem; color: var(--warning-amber);">85% utilized</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 85%; background: var(--warning-amber);"></div>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">
                        5 scheduled tasks ‚Ä¢ Available: Thu 2-5 PM
                    </div>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-weight: 600;">Sarah Johnson</span>
                        <span style="font-size: 0.9rem; color: var(--success-green);">60% utilized</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 60%; background: var(--success-green);"></div>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">
                        3 scheduled tasks ‚Ä¢ Available: Mon, Wed PM
                    </div>
                </div>
                
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-weight: 600;">Mike Wilson</span>
                        <span style="font-size: 0.9rem; color: var(--primary-blue);">75% utilized</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 75%; background: var(--primary-blue);"></div>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">
                        4 scheduled tasks ‚Ä¢ Available: Tue, Fri AM
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Equipment Availability -->
        <div>
            <h4 style="margin-bottom: 1rem;">üè≠ Equipment Availability</h4>
            <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--border-radius);">
                <div style="margin-bottom: 0.5rem; display: flex; justify-content: space-between;">
                    <span>Pump #1</span>
                    <span style="color: var(--success-green);">Available</span>
                </div>
                <div style="margin-bottom: 0.5rem; display: flex; justify-content: space-between;">
                    <span>HVAC Unit A</span>
                    <span style="color: var(--warning-amber);">Scheduled Wed</span>
                </div>
                <div style="margin-bottom: 0.5rem; display: flex; justify-content: space-between;">
                    <span>Conveyor #3</span>
                    <span style="color: var(--error-red);">Down for repair</span>
                </div>
                <div style="margin-bottom: 0.5rem; display: flex; justify-content: space-between;">
                    <span>Motor #2</span>
                    <span style="color: var(--success-green);">Available</span>
                </div>
                <div style="margin-bottom: 0.5rem; display: flex; justify-content: space-between;">
                    <span>Boiler</span>
                    <span style="color: var(--warning-amber);">Scheduled Thu</span>
                </div>
            </div>
        </div>
        
        <!-- Parts & Tools -->
        <div>
            <h4 style="margin-bottom: 1rem;">üîß Parts & Tools Availability</h4>
            <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--border-radius);">
                <div style="margin-bottom: 0.5rem; display: flex; justify-content: space-between;">
                    <span>Oil Filters</span>
                    <span style="color: var(--success-green);">15 in stock</span>
                </div>
                <div style="margin-bottom: 0.5rem; display: flex; justify-content: space-between;">
                    <span>V-Belts</span>
                    <span style="color: var(--error-red);">3 in stock (low)</span>
                </div>
                <div style="margin-bottom: 0.5rem; display: flex; justify-content: space-between;">
                    <span>Bearings</span>
                    <span style="color: var(--success-green);">8 in stock</span>
                </div>
                <div style="margin-bottom: 0.5rem; display: flex; justify-content: space-between;">
                    <span>Torque Wrench</span>
                    <span style="color: var(--warning-amber);">Reserved Thu</span>
                </div>
                <div style="margin-bottom: 0.5rem; display: flex; justify-content: space-between;">
                    <span>Multimeter</span>
                    <span style="color: var(--success-green);">Available</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
// Scheduler-specific JavaScript
function createSchedule() {
    alert('Schedule creation wizard - Feature coming soon! Will include drag-and-drop scheduling and resource allocation.');
}

function viewScheduleItem(id) {
    alert(`View schedule item ${id} - Feature coming soon! Will show detailed task information and options to modify.`);
}

function changeCalendarView() {
    const viewType = document.getElementById('viewType').value;
    alert(`Switching to ${viewType} view - Feature coming soon! Will provide different calendar perspectives.`);
}

function applyScheduleFilter() {
    const filterBy = document.getElementById('filterBy').value;
    const technicianFilter = document.getElementById('technicianFilter').value;
    alert(`Applying filters: ${filterBy || 'All'} activities, ${technicianFilter || 'All'} technicians`);
}

function previousPeriod() {
    alert('Navigate to previous period - Feature coming soon!');
}

function nextPeriod() {
    alert('Navigate to next period - Feature coming soon!');
}

function today() {
    alert('Navigate to current period - Feature coming soon!');
}

function resolveConflict(id) {
    if (confirm(`Resolve scheduling conflict ${id}?`)) {
        alert(`Conflict ${id} resolved! Alternative scheduling options provided.`);
        refreshData();
    }
}

function rescheduleTask(id) {
    const newTime = prompt(`Enter new time for task ${id} (e.g., 'Mon 2 PM'):`);
    if (newTime) {
        alert(`Task ${id} rescheduled to ${newTime}`);
        refreshData();
    }
}

function assignTechnician(id) {
    const technician = prompt('Assign to which technician?');
    if (technician) {
        alert(`Task ${id} assigned to ${technician}`);
        refreshData();
    }
}

async function optimizeSchedule() {
    try {
        const response = await sendChatMessage('Optimize the current schedule for maximum efficiency, resource utilization, and minimal conflicts', 'scheduler');
        alert('ü§ñ Schedule Optimization Complete:\n\nOPTIMIZATIONS APPLIED:\n‚Ä¢ Moved 3 tasks to balance technician workload\n‚Ä¢ Rescheduled equipment maintenance during low-demand periods\n‚Ä¢ Resolved 2 resource conflicts\n‚Ä¢ Optimized travel time between locations\n\nIMPROVEMENTS:\n‚Ä¢ 23% increase in efficiency\n‚Ä¢ 15% better resource utilization\n‚Ä¢ Zero scheduling conflicts\n‚Ä¢ Reduced equipment downtime by 2 hours\n\nESTIMATED SAVINGS: $1,200 this week');
    } catch (error) {
        alert('Unable to optimize schedule at this time.');
    }
}

async function applyAIOptimization() {
    if (confirm('Apply AI optimization suggestions to the current schedule?')) {
        alert('ü§ñ Applying AI Optimization:\n\n‚Ä¢ Redistributing workload for balanced efficiency\n‚Ä¢ Rescheduling overlapping maintenance windows\n‚Ä¢ Optimizing technician assignments based on skills\n‚Ä¢ Adjusting timing for resource availability\n\nChanges will take effect immediately.\nEstimated efficiency improvement: 23%');
        refreshData();
    }
}

async function previewOptimization() {
    try {
        const response = await sendChatMessage('Preview schedule optimization changes without applying them', 'scheduler');
        alert('ü§ñ Optimization Preview:\n\nPROPOSED CHANGES:\n‚Ä¢ Move Pump #1 maintenance from Mon 8 AM to Tue 9 AM\n‚Ä¢ Reassign HVAC work from John to Sarah (balances workload)\n‚Ä¢ Combine Motor #2 service with nearby equipment check\n‚Ä¢ Reschedule emergency backup for better resource coverage\n\nIMPACT ANALYSIS:\n‚Ä¢ Efficiency: +23%\n‚Ä¢ Resource utilization: +15%\n‚Ä¢ Cost savings: $1,200/week\n‚Ä¢ Zero conflicts after optimization\n\nClick "Apply AI Optimization" to implement these changes.');
    } catch (error) {
        alert('Unable to generate optimization preview at this time.');
    }
}

function bulkReschedule() {
    alert('Bulk reschedule tools - Feature coming soon! Will allow mass rescheduling with conflict resolution.');
}

function exportSchedule() {
    alert('Export schedule - Feature coming soon! Will support calendar formats and PDF reports.');
}

// Helper function to send AI messages with scheduler context
async function sendChatMessage(message, context = 'scheduler') {
    try {
        const response = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                message: message,
                user_role: context,
                context: 'Maintenance scheduling and planning'
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Add to chat window
            addChatMessage(message, 'user');
            addChatMessage(data.response, 'ai');
            return data.response;
        }
    } catch (error) {
        console.error('Scheduler AI message error:', error);
    }
}

// Initialize drag and drop for calendar (placeholder)
document.addEventListener('DOMContentLoaded', function() {
    // Calendar drag-and-drop functionality would be implemented here
    console.log('Scheduler calendar initialized');
});
{% endblock %}